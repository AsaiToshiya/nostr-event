<!DOCTYPE html>
<html>
  <head>
    <title>nostr-event</title>
  </head>
  <body>
    <h1>nostr-event</h1>
    <div style="display: flex; align-items: start">
      content:
      <textarea id="content" rows="4" cols="50"></textarea>
    </div>
    kind:
    <input id="kind" type="text" value="1" /><br />
    tags:<br />
    k:
    <input id="k" type="text" /><br />
    nsec:
    <input id="nsec" type="text" size="50" /><br />
    <button onclick="handleClick()">publish</button>
    <button onclick="handleStringifyClick()">stringify (not publish)</button
    ><br />
    JSON:
    <pre id="json"></pre>

    <script src="https://unpkg.com/nostr-tools/lib/nostr.bundle.js"></script>
    <script>
      const relays = [
        "wss://nos.lol",
        "wss://nostr.bitcoiner.social",
        "wss://nostr.mom",
        "wss://relay.damus.io",
        "wss://relay.nostr.bg",
      ];

      const handleClick = async () => {
        const sk = window.NostrTools.nip19.decode(nsec.value).data;
        const pk = window.NostrTools.getPublicKey(sk);

        const event = window.NostrTools.finishEvent(
          {
            kind: parseInt(kind.value, 10),
            created_at: Math.floor(Date.now() / 1000),
            tags: [...(k.value ? [["k", k.value]] : [])],
            content: content.value,
          },
          sk
        );

        const pool = new window.NostrTools.SimplePool();
        pool.publish(relays, event);
        pool.close(relays);

        json.innerText = JSON.stringify(event, null, 2);
      };

      const handleStringifyClick = async () => {
        const sk = window.NostrTools.nip19.decode(nsec.value).data;
        const pk = window.NostrTools.getPublicKey(sk);

        const event = window.NostrTools.finishEvent(
          {
            kind: parseInt(kind.value, 10),
            created_at: Math.floor(Date.now() / 1000),
            tags: [...(k.value ? [["k", k.value]] : [])],
            content: content.value,
          },
          sk
        );

        json.innerText = JSON.stringify(event);
      };
    </script>
  </body>
</html>
